<%- include('../partials/header') %>

<div class="container-scroller">
    <header class="header border-bottom">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-3 col-md-3 col-6">
                    <div class="header__logo">
                        <a class="text-decoration-none" href="/">
                            <h1 class="fw-bold" style="font-style: italic;">Glassics</h1>
                        </a>
                    </div>
                </div>
                <div class="col-lg-6 col-md-6 d-none d-md-block">
                    <nav class="header__menu mobile-menu">
                        <ul>
                            <li><a class="text-decoration-none" href="/">Home</a></li>
                            <li><a class="text-decoration-none" href="/shop">Shop</a></li>
                            <li class="active"><a class="text-decoration-none" href="/account/profile">Account</a></li>
                            <li><a class="text-decoration-none" href="./blog.html">Blog</a></li>
                            <li><a class="text-decoration-none" href="./contact.html">Contacts</a></li>
                        </ul>
                    </nav>
                </div>
                <div class="col-lg-3 col-md-3 col-6 d-flex justify-content-end align-items-center">
                    <div class="header__nav__option mr-3">
                        <a href="#" class="search-switch"><img src="/static/img/icon/search.png" alt=""></a>
                        <a href="#"><img src="/static/img/icon/heart.png" alt=""></a>
                        <a href="/cart"><img src="/static/img/icon/cart.png" alt=""> <span>0</span></a>
                    </div>
                    <button class="navbar-toggler d-lg-none ml-auto mt-1" type="button" data-toggle="collapse" data-target="#navbarNav">
                        <span class="navbar-toggler-icon fa fa-bars"></span>
                    </button>
                    <button class="navbar-toggler navbar-toggler-right d-lg-none mb-2" type="button" data-toggle="offcanvas"><span
                        class="fa fa-chevron-down"></span></button>
                </div>
            </div>
            <div class="collapse navbar-collapse" id="navbarNav">
                <nav class="navbar-nav active">
                    <ul class="navbar-nav">
                        <li><a class="nav-link" href="/">Home</a></li>
                        <li><a class="nav-link" href="/shop">Shop</a></li>
                        <li class="active"><a class="nav-link" href="/account/profile" style="color: red;">Account</a></li>
                        <li><a class="nav-link" href="./blog.html">Blog</a></li>
                        <li><a class="nav-link" href="./contact.html">Contacts</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>
    <!-- partial -->
    <div class="container-fluid page-body-wrapper ps-0 pe-0">
        <!-- partial:partials/_sidebar.html -->
        <nav class="sidebar sidebar-offcanvas border" id="sidebar">
            <ul class="nav">
                <li class="nav-item">
                    <a class="nav-link" href="/account/profile">
                        <span class="menu-title">Profile</span>
                        <i class="mdi mdi-home menu-icon"></i>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/account/wishlist">
                        <span class="menu-title">Wishlist</span>
                        <i class="menu-arrow"></i>
                        <i class="mdi mdi-crosshairs-gps menu-icon"></i>
                    </a>
                </li>
                <li class="nav-item active bg-gradient-info">
                    <a class="nav-link">
                        <span class="menu-title font-weight-bold text-white">Orders</span>
                        <i class="mdi mdi-contacts menu-icon"></i>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/account/address">
                        <span class="menu-title">Address</span>
                        <i class="mdi mdi-chart-bar menu-icon"></i>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/account/wallet">
                        <span class="menu-title">Wallet</span>
                        <i class="mdi mdi-table-large menu-icon"></i>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/admin/coupons">
                        <span class="menu-title">Coupons</span>
                        <i class="menu-arrow"></i>
                        <i class="mdi mdi-medical-bag menu-icon"></i>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/admin/banners">
                        <span class="menu-title">Banners</span>
                        <i class="menu-arrow"></i>
                        <i class="mdi mdi-medical-bag menu-icon"></i>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/admin/Offers">
                        <span class="menu-title">Offers</span>
                        <i class="menu-arrow"></i>
                        <i class="mdi mdi-medical-bag menu-icon"></i>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/logout">
                        <span class="menu-title">Logout</span>
                        <i class="menu-arrow"></i>
                        <i class="mdi mdi-medical-bag menu-icon"></i>
                    </a>
                </li>
            </ul>
        </nav>
        <div class="main-panel mt-5 pt-2 w-100">
             <!-- Breadcrumb Section Begin -->
    <section class="breadcrumb-option mt-5" style="background-color: rgb(232, 243, 250);">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-12">
                    <div class="breadcrumb__text ps-4">
                        <h4>Orders</h4>
                        <div>
                            <a class="text-decoration-none text-dark fw-bold" href="/">Home&nbsp;&gt;&nbsp;</a>
                            <a class="text-decoration-none text-dark fw-bold" href="/account/profile">Account</a>
                            <span>&nbsp;&gt;&nbsp;Orders</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Breadcrumb Section End -->
            <div class="content-wrapper row" style="background-color: white;">
                <section class="shopping-cart spad">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="table-responsive">
                                    <table class="w-100 text-center">
                                        <thead>
                                            <tr class="border-bottom">
                                                <th class="pe-4 p-3">Order ID</th>
                                                <th class="pe-4">Order Date</th>
                                                <th class="pe-4">Total Price</th>
                                                <th class="pe-4">Items Count</th>
                                                <th class="pe-4">Status</th>
                                                <th class="pe-4">Details</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <% if(orders.length > 0) { %>
                                                <% orders.forEach(order => { 
                                                    let totalPrice = 0;
                                                    let itemsCount = order.items.length;
                                                    order.items.forEach(item => {
                                                        totalPrice += item.productPrice * item.quantity;
                                                    });
                                                %>
                                                    <tr class="border-bottom">
                                                        <td class="pe-4 p-4">
                                                            <%= order.orderID %>
                                                        </td>
                                                        <td class="pe-4 p-4">
                                                            <%= order.orderDate %>
                                                        </td>
                                                        <td class="cart__price pe-4">&#8377;<%= totalPrice.toFixed(2) %></td>
                                                        <td class="pe-4"><%= itemsCount %></td>
                                                        <td class="pe-4 pt-3">
                                                            <% let allDelivered = true; %>
                                                            <% let allCancelled = true; %>
                                                            
                                                            <% order.items.forEach(item => { %>
                                                                <% if (item.orderStatus !== 'Delivered') { %>
                                                                    <% allDelivered = false; %>
                                                                <% } %>
                                                                <% if (item.orderStatus !== 'Canceled') { %>
                                                                    <% allCancelled = false; %>
                                                                <% } %>
                                                            <% }); %>
                                                            
                                                            <% if (allDelivered) { %>
                                                                <p class="text-success">Delivered</p>
                                                            <% } else if (allCancelled) { %>
                                                                <p class="text-warning">Canceled</p>
                                                            <% } else { %>
                                                                <p>Pending</p>
                                                            <% } %>
                                                        </td>
                                                        
                                                                                                                 
                                                        <td class="pe-4">
                                                            <a href="/account/orders/order_details?id=<%= order._id %>" class="btn btn-primary">Info</a>
                                                        </td>
                                                    </tr>
                                                <% }) %>
                                            <% } else { %>
                                                <tr class="text-center">
                                                    <td colspan="5">No orders found!</td>
                                                </tr>
                                            <% } %>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>  
            </div>
            <!-- content-wrapper ends -->
            <!-- partial:partials/_footer.html -->
            <!-- partial -->
        </div>
        
    <!-- page-body-wrapper ends -->
</div>
<!-- container-scroller --> 
<style>
    header {
        position: relative;
        position: fixed;
        width: 100vw;
        z-index: 999;
    }
    .sidebar{
        position: relative;
        position: absolute;
        position: fixed;
        z-index: 999;
        top:104px;
    }
    @media ( min-width : 992px){
        .main-panel {
            margin-left: 250px;
            width: 100%;
        }
        .sidebar {
            margin-top: 12.3px;
        }
    }
</style>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
    $(document).ready(function () {
        $('[data-toggle="offcanvas"]').click(function () {
            $('.sidebar-offcanvas').toggleClass('active');
        });
    });
</script>

<!-- plugins:js -->
<script src="assets/vendors/js/vendor.bundle.base.js"></script>
<!-- endinject -->
<!-- Plugin js for this page -->
<script src="assets/vendors/chart.js/Chart.min.js"></script>
<script src="assets/js/jquery.cookie.js" type="text/javascript"></script>
<!-- End plugin js for this page -->
<!-- inject:js -->
<script src="assets/js/off-canvas.js"></script>
<script src="assets/js/hoverable-collapse.js"></script>
<script src="assets/js/misc.js"></script>
<!-- endinject -->
<!-- Custom js for this page -->
<script src="assets/js/dashboard.js"></script>
<script src="assets/js/todolist.js"></script>
<!-- End custom js for this page -->


<%- include('../partials/footer') %>