<%- include('../partials/header') %>

<div class="center-div" style="background-image: url(/static/img/hero/bg-3.jpg);">
    <div class="alogdiv container text-center">
        <a class="text-decoration-none" href="/"><h1 class="fw-bold" style="font-style: italic;">Glassics</h1></a>
        <div class="alogcon">
            <h5 class="alogtit">Admin Login</h5>
            <% if(locals.message) { %>
                <div class="alert text-warning text-center" id="message">
                    <%= message %>
                </div>
            <% } %>
            <div id="error" class="text-warning fw-bold"></div>
            <form id="form">
                <div class="form-group mb-3">
                    <input type="text" class="form-control" id="adminName" name="adminName" placeholder="Enter Username">
                </div>
                <div class="form-group mb-3">
                    <input type="password" id="apassword" class="form-control" name="apassword" placeholder="Enter Password">
                </div>
                <button type="submit" class="btn btn-secondary rounded-pill">Submit</button>
            </form>
        </div>
    </div>
</div>
<style>
    .center-div {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
    }

    .alogdiv {
        background-color: #f8f9fa;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        max-width: 400px; /* Adjust the max-width as needed */
        width: 100%;
    }

    .alogtit {
        color: #333;
    }

    .alert {
        margin-bottom: 20px;
    }

    .form-control {
        border-radius: 20px;
    }

    .btn-secondary {
        background-color: #6c757d;
        border-color: #6c757d;
    }

    .btn-secondary:hover {
        background-color: #5a6268;
        border-color: #545b62;
    }
</style>

<%- include('../partials/footer') %>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const form = document.getElementById('form');
        const errorDiv = document.getElementById('error');
        const messageDiv = document.getElementById('message');

        if (messageDiv) {
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            errorDiv.innerText = '';
            const adminName = document.getElementById('adminName').value.trim();
            const apassword = document.getElementById('apassword').value.trim();
            const errors = [];

            if (!adminName){
                errors.push('Name is required')
            }
            if (!apassword) {
                errors.push('Password is required');
            }

            if (errors.length > 0) {
                errorDiv.innerText = errors[0];
                return;
            }

            try {
                const response = await fetch('/admin/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ adminName, apassword })
                });

                const result = await response.json();

                if (response.ok) {
                    window.location.href = '/admin/dashboard';
                } else {
                    errorDiv.innerText = result.message;
                }
            } catch (err) {
                errorDiv.innerText = 'An error occurred. Please try again later.';
            }
        });
    });
</script>
