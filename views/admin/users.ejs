<%- include('../partials/header') %>

    <div class="container-scroller">
      <!-- partial:partials/_navbar.html -->
      <nav class="navbar default-layout-navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
        <div class="text-center navbar-brand-wrapper d-flex align-items-center justify-content-center">
          <a class="text-decoration-none" href="/"><h1 class="fw-bold" style="font-style: italic;">Glassics</h1></a>
        </div>
        <div class="navbar-menu-wrapper d-flex align-items-stretch">
          <button class="navbar-toggler navbar-toggler align-self-center" type="button" data-toggle="minimize">
            <span class="mdi mdi-menu"></span>
          </button>
          <div class="search-field d-none d-md-block">
            <form class="d-flex align-items-center h-100" action="#">
              <div class="input-group">
                <div class="input-group-prepend bg-transparent">
                  <i class="input-group-text border-0 mdi mdi-magnify"></i>
                </div>
                <input type="text" class="form-control bg-transparent border-0 mt-2" placeholder="Search">
              </div>
            </form>
          </div>
          <button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button" data-toggle="offcanvas">
            <span class="mdi mdi-menu"></span>
          </button>
        </div>
      </nav>
      <!-- partial -->
      <div class="container-fluid page-body-wrapper">
        <!-- partial:partials/_sidebar.html -->
        <nav class="sidebar sidebar-offcanvas" id="sidebar">
          <ul class="nav">
            <li class="nav-item">
              <a class="nav-link" href="/admin/dashboard">
                <span class="menu-title">Dashboard</span>
                <i class="mdi mdi-home menu-icon"></i>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/admin/products">
                <span class="menu-title">Products</span>
                <i class="menu-arrow"></i>
                <i class="mdi mdi-crosshairs-gps menu-icon"></i>
              </a>
            </li>
            <li class="nav-item active">
              <a class="nav-link" href="/admin/users">
                <span class="menu-title">Users</span>
                <i class="mdi mdi-contacts menu-icon"></i>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/admin/orders">
                <span class="menu-title">Orders</span>
                <i class="mdi mdi-format-list-bulleted menu-icon"></i>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/admin/categories">
                <span class="menu-title">Categories</span>
                <i class="mdi mdi-chart-bar menu-icon"></i>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/admin/brands">
                <span class="menu-title">Brands</span>
                <i class="mdi mdi-table-large menu-icon"></i>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/admin/coupons">
                <span class="menu-title">Coupons</span>
                <i class="menu-arrow"></i>
                <i class="mdi mdi-medical-bag menu-icon"></i>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/admin/offers">
                <span class="menu-title">Offers</span>
                <i class="menu-arrow"></i>
                <i class="mdi mdi-medical-bag menu-icon"></i>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/admin/logout">
                <span class="menu-title">Logout</span>
                <i class="menu-arrow"></i>
                <i class="mdi mdi-medical-bag menu-icon"></i>
              </a>
            </li>
          </ul>
        </nav>
        <!-- partial -->
        <div class="main-panel">
          <div class="content-wrapper">
              <div class="page-header">
                  <h3 class="page-title">
                      <span class="page-title-icon bg-gradient-primary text-white mr-2">
                          <i class="mdi mdi-home"></i>
                      </span> Users
                  </h3>
              </div>
              <table class="table table-striped">
                  <thead>
                      <tr class="text-center">
                          <th>Image</th>
                          <th>Name</th>
                          <th>Username</th>
                          <th>Email</th>
                          <th>Mobile</th>
                          <th>Status</th>
                      </tr>
                  </thead>
                  <tbody class="text-center">
                      <% if(users.length > 0) { %>
                          <% for(let i = 0; i < users.length; i++) { %>
                              <tr>
                                  <td><img src="<%= users[i].userImage ? `/static/userImages/${users[i].userImage}` : '/static/userImages/default.jpg' %>" alt="" width="150px" height="150px"></td>
                                  <td><%= users[i].customerName %></td>
                                  <td><%= users[i].userName %></td>
                                  <td><%= users[i].userEmail %></td>
                                  <td><%= users[i].userMobile %></td>
                                  <td>
                                      <% if(users[i].is_blocked) { %>
                                          <a href="#" class="btn btn-danger btn-sm" onclick="confirmUnblock('<%= users[i]._id %>')">Blocked</a>
                                      <% } else { %>
                                          <a href="#" class="btn btn-success btn-sm" onclick="confirmBlock('<%= users[i]._id %>')">Active</a>
                                      <% } %>
                                  </td>
                              </tr>
                          <% } %>
                      <% } else { %>
                          <tr>
                              <td colspan="6" class="text-center">Users not found</td>
                          </tr>
                      <% } %>
                  </tbody>
              </table>
              <div class="pagination d-flex justify-content-center align-items-center mt-3">
                  <% if (currentPage > 1) { %>
                      <a href="?page=<%= currentPage - 1 %>&limit=<%= limit %>" class="btn btn-info mr-1">&lt;</a>
                  <% } %>
                  <% for (let i = Math.max(1, currentPage - 1); i <= Math.min(currentPage + 1, totalPages); i++) { %>
                      <a href="?page=<%= i %>&limit=<%= limit %>" class="btn btn-secondary <%= currentPage === i ? 'active' : '' %>"><%= i %></a>
                  <% } %>
                  <% if (currentPage < totalPages) { %>
                      <a href="?page=<%= currentPage + 1 %>&limit=<%= limit %>" class="btn btn-info ml-1">&gt;</a>
                  <% } %>
              </div>
          </div>
      </div>
      </div>
    </div>
    <!-- container-scroller -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>
    function confirmBlock(userId) {
      Swal.fire({
        title: 'Are you sure?',
        text: 'This action cannot be undone.',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Yes, block user!',
        cancelButtonText: 'Cancel',
        reverseButtons: true
      }).then((result) => {
        if (result.isConfirmed) {
          fetch(`/admin/users/block_user?id=${userId}`, {
            method: 'GET'
          })
            .then(response => response.json())
            .then(data => {
              if (data.message === 'User blocked successfully') {
                Swal.fire(
                  'Blocked!',
                  'The user has been blocked.',
                  'success'
                ).then(() => {
                  window.location.reload();
                });
              } else {
                Swal.fire(
                  'Error!',
                  'There was a problem blocking the user.',
                  'error'
                );
              }
            })
            .catch(error => {
              Swal.fire(
                'Error!',
                'There was a problem blocking the user.',
                'error'
              );
            });
        }
      });
    }

    function confirmUnblock(userId) {
      Swal.fire({
        title: 'Are you sure?',
        text: 'This action cannot be undone.',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Yes, unblock user!',
        cancelButtonText: 'Cancel',
        reverseButtons: true
      }).then((result) => {
        if (result.isConfirmed) {
          fetch(`/admin/users/unblock_user?id=${userId}`, {
            method: 'GET'
          })
            .then(response => response.json())
            .then(data => {
              if (data.message === 'User unblocked successfully') {
                Swal.fire(
                  'Unblocked!',
                  'The user has been unblocked.',
                  'success'
                ).then(() => {
                  window.location.reload();
                });
              } else {
                Swal.fire(
                  'Error!',
                  'There was a problem unblocking the user.',
                  'error'
                );
              }
            })
            .catch(error => {
              Swal.fire(
                'Error!',
                'There was a problem unblocking the user.',
                'error'
              );
            });
        }
      });
    }
  </script>
    <!-- plugins:js -->
    <script src="assets/vendors/js/vendor.bundle.base.js"></script>
    <!-- endinject -->
    <!-- Plugin js for this page -->
    <script src="assets/vendors/chart.js/Chart.min.js"></script>
    <script src="assets/js/jquery.cookie.js" type="text/javascript"></script>
    <!-- End plugin js for this page -->
    <!-- inject:js -->
    <script src="assets/js/off-canvas.js"></script>
    <script src="assets/js/hoverable-collapse.js"></script>
    <script src="assets/js/misc.js"></script>
    <!-- endinject -->
    <!-- Custom js for this page -->
    <script src="assets/js/dashboard.js"></script>
    <script src="assets/js/todolist.js"></script>
    <!-- End custom js for this page -->

<%- include('../partials/footer') %>